# kubernetes/apps/default/komga/volsync-repo-secret.yaml
# Produces a Secret named `volsync-restic-komga` with the two required keys
# for a pvc:// restic repo on NFS.
apiVersion: k8s.bitwarden.com/v1
kind: BitwardenSecret
metadata:
  name: volsync-restic-komga
  namespace: default
  annotations:
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
    argocd.argoproj.io/sync-wave: "0"
spec:
  secretName: volsync-restic-komga
  organizationId: "9f7b77c1-18f7-4dc8-b252-b274015d6c40"
  authToken:
    secretName: bw-auth-token
    secretKey: token
  map:
    # Existing BW item for your restic password
    - bwSecretId: "9e0e9c6d-b7c3-4434-9cfe-b343013718b2"
      secretKeyName: RESTIC_PASSWORD
    # Create a BW item whose value is:
    #   pvc://volsync-backup-repo-pvc?subPath=komga
    # and put its item ID below
    - bwSecretId: "dc3157b9-bfd8-4740-97a8-b34d012084a0"
      secretKeyName: RESTIC_REPOSITORY
    # S3 credentials for Garage (HTTP endpoint)
    - bwSecretId: "99a3f117-107f-4555-b136-b34d013cf111"
      secretKeyName: AWS_ACCESS_KEY_ID
    - bwSecretId: "7a3338b0-6052-4eba-916f-b34d013d0d2f"
      secretKeyName: AWS_SECRET_ACCESS_KEY
    - bwSecretId: "4ce91aad-0eff-4b0b-a32b-b34d013cde91"
      secretKeyName: AWS_DEFAULT_REGION
    - bwSecretId: "9598990e-a62c-4f44-8549-b34d0140d6e4"
      secretKeyName: AWS_S3_FORCE_PATH_STYLE
